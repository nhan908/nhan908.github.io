<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monopoly Banker & Rent</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #27ae60;
            --danger: #c0392b;
            --light: #f4f6f7;
            --dark: #2c3e50;
        }
        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        body { margin: 0; padding: 0; background-color: #eef2f5; color: var(--dark); }

        .container { max-width: 600px; margin: 0 auto; padding: 15px; padding-bottom: 80px; }

        /* Header & Sticky Actions */
        header { 
            text-align: center; margin-bottom: 20px; 
            padding-bottom: 10px; border-bottom: 2px solid #ddd;
        }
        
        /* Floating Action Button for Rent */
        .fab-container {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; z-index: 99;
            width: 90%; max-width: 580px;
        }
        .btn-large-action {
            flex: 1; padding: 15px; border: none; border-radius: 50px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        .btn-rent { background-color: var(--primary); color: white; }
        .btn-rent:active { transform: translateX(-50%) scale(0.95); }

        /* Setup Area */
        .setup-box { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }

        /* Player List (Accordion) */
        .player-list { display: flex; flex-direction: column; gap: 10px; }
        
        .player-row {
            background: white; border-radius: 8px; overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .player-summary {
            padding: 15px; display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; background: white; user-select: none;
        }
        .player-summary:hover { background-color: #fafafa; }
        
        .p-name { font-weight: 700; font-size: 1.1rem; }
        .p-money { font-weight: 800; font-size: 1.2rem; color: var(--accent); }
        .chevron { transition: transform 0.2s; color: #999; }
        .expanded .chevron { transform: rotate(180deg); }

        /* Expanded Details */
        .player-details {
            display: none; padding: 15px; background-color: #f8f9fa; border-top: 1px solid #eee;
        }
        .expanded .player-details { display: block; animation: slideDown 0.2s ease-out; }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Controls inside accordion */
        .control-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .btn { padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; }
        .btn-go { background: #d5f5e3; color: #1e8449; grid-column: span 2; }
        .btn-jail { background: #fadbd8; color: #922b21; }
        .btn-prop { background: #d6eaf8; color: #21618c; grid-column: span 2; }
        .btn-custom { background: #eaecee; color: #333; grid-column: span 2; }

        /* Property Chips */
        .prop-list { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
        .prop-chip { 
            font-size: 0.75rem; color: white; padding: 4px 8px; border-radius: 4px; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* Modals */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: flex-end;
        }
        .modal-content {
            background: white; width: 100%; max-width: 600px; 
            border-radius: 15px 15px 0 0; padding: 20px;
            animation: slideUp 0.3s;
        }
        @keyframes slideUp { from {transform: translateY(100%);} to {transform: translateY(0);} }

        .transfer-grid {
            display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: center; margin: 20px 0;
        }
        select, input[type="number"] { width: 100%; padding: 12px; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem; }
        .arrow-icon { font-size: 1.5rem; color: #777; text-align: center; }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>üè¶ Monopoly Ledger</h2>
    </header>

    <div id="setup-area" class="setup-box">
        <input type="text" id="new-name" placeholder="Enter Player Name">
        <button class="btn btn-prop" style="width: auto; padding: 0 20px;" onclick="addPlayer()">Add</button>
    </div>
    
    <div id="start-btn-container" style="text-align: center; margin-bottom: 20px;">
        <button class="btn btn-go" onclick="startGame()">Begin Game</button>
    </div>

    <div id="player-list" class="player-list"></div>

    <div id="game-controls" class="fab-container hidden">
        <button class="btn-large-action btn-rent" onclick="openTransferModal()">üí∏ Pay Rent / Transfer</button>
    </div>
</div>

<div id="transfer-modal" class="modal-overlay" onclick="if(event.target === this) closeTransferModal()">
    <div class="modal-content">
        <h3>üí∏ Settle Rent / Transfer</h3>
        
        <div class="transfer-grid">
            <div>
                <label style="font-size:0.8rem; color:#666;">PAYER</label>
                <select id="t-payer"></select>
            </div>
            <div class="arrow-icon">‚ûî</div>
            <div>
                <label style="font-size:0.8rem; color:#666;">RECIPIENT</label>
                <select id="t-recipient"></select>
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="font-size:0.8rem; color:#666;">AMOUNT (¬£)</label>
            <input type="number" id="t-amount" placeholder="e.g. 50">
        </div>

        <button class="btn btn-go" style="width: 100%; font-size: 1.1rem;" onclick="executeTransfer()">Confirm Transfer</button>
        <button class="btn btn-custom" style="width: 100%; margin-top: 10px;" onclick="closeTransferModal()">Cancel</button>
    </div>
</div>

<div id="prop-modal" class="modal-overlay" onclick="if(event.target === this) document.getElementById('prop-modal').style.display='none'">
    <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
        <h3>Manage Properties</h3>
        <div id="prop-list-container"></div>
        <button class="btn btn-custom" style="width: 100%; margin-top: 10px;" onclick="document.getElementById('prop-modal').style.display='none'">Close</button>
    </div>
</div>

<script>
    // --- STATE ---
    let players = [];
    let gameActive = false;
    let editingPlayerId = null;

    // Standard UK Properties
    const properties = [
        {name:"Old Kent Rd",c:"#8B4513",p:60},{name:"Whitechapel",c:"#8B4513",p:60},
        {name:"Kings Cross",c:"#000000",p:200},{name:"The Angel",c:"#87CEEB",p:100},{name:"Euston Rd",c:"#87CEEB",p:100},{name:"Pentonville",c:"#87CEEB",p:120},
        {name:"Pall Mall",c:"#C71585",p:140},{name:"Electric Co",c:"#777",p:150},{name:"Whitehall",c:"#C71585",p:140},{name:"Northumrlnd",c:"#C71585",p:160},
        {name:"Marylebone",c:"#000000",p:200},{name:"Bow St",c:"#FFA500",p:180},{name:"Marlborough",c:"#FFA500",p:180},{name:"Vine St",c:"#FFA500",p:200},
        {name:"Strand",c:"#FF0000",p:220},{name:"Fleet St",c:"#FF0000",p:220},{name:"Trafalgar Sq",c:"#FF0000",p:240},
        {name:"Fenchurch",c:"#000000",p:200},{name:"Leicester Sq",c:"#FFFF00",p:260},{name:"Coventry St",c:"#FFFF00",p:260},
        {name:"Water Works",c:"#777",p:150},{name:"Piccadilly",c:"#FFFF00",p:280},
        {name:"Regent St",c:"#008000",p:300},{name:"Oxford St",c:"#008000",p:300},{name:"Bond St",c:"#008000",p:320},
        {name:"Liverpool St",c:"#000000",p:200},{name:"Park Lane",c:"#00008B",p:350},{name:"Mayfair",c:"#00008B",p:400}
    ].map((p,i)=>({...p, id:i, owner:null}));

    // --- SETUP FUNCTIONS ---
    function addPlayer() {
        const input = document.getElementById('new-name');
        const name = input.value.trim();
        if(!name) return;
        players.push({ id: Date.now(), name: name, money: 1500 });
        input.value = '';
        renderPlayers();
    }

    function startGame() {
        if(players.length < 2) return alert("Need at least 2 players!");
        gameActive = true;
        document.getElementById('setup-area').classList.add('hidden');
        document.getElementById('start-btn-container').classList.add('hidden');
        document.getElementById('game-controls').classList.remove('hidden');
        renderPlayers();
    }

    // --- RENDER LOGIC ---
    function renderPlayers() {
        const list = document.getElementById('player-list');
        list.innerHTML = '';

        players.forEach(p => {
            const row = document.createElement('div');
            row.className = `player-row ${p.id === editingPlayerId ? 'expanded' : ''}`;
            
            // Get properties
            const myProps = properties.filter(prop => prop.owner === p.id);
            const propHtml = myProps.map(x => 
                `<span class="prop-chip" style="background:${x.c}">${x.name}</span>`
            ).join('');

            row.innerHTML = `
                <div class="player-summary" onclick="togglePlayer(${p.id})">
                    <span class="p-name">${p.name}</span>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span class="p-money">¬£${p.money}</span>
                        <span class="chevron">‚ñº</span>
                    </div>
                </div>
                <div class="player-details">
                    <div class="control-group">
                        <button class="btn btn-go" onclick="updateMoney(${p.id}, 200)">Pass Go (+¬£200)</button>
                        <button class="btn btn-jail" onclick="updateMoney(${p.id}, -50)">Pay Jail / Tax (-¬£50)</button>
                        <button class="btn btn-custom" onclick="customAmount(${p.id})">Manual Adjust (+/-)</button>
                        <button class="btn btn-prop" onclick="openPropModal(${p.id})">Manage Properties</button>
                    </div>
                    <div style="border-top:1px solid #eee; padding-top:10px;">
                        <small style="color:#777; font-weight:bold;">PROPERTIES:</small>
                        <div class="prop-list">${propHtml || '<span style="color:#aaa; font-size:0.8rem">None</span>'}</div>
                    </div>
                </div>
            `;
            list.appendChild(row);
        });
    }

    function togglePlayer(id) {
        // Toggle collapse/expand
        editingPlayerId = (editingPlayerId === id) ? null : id;
        renderPlayers();
    }

    // --- MONEY LOGIC ---
    function updateMoney(pid, amt) {
        players.find(p => p.id === pid).money += amt;
        renderPlayers();
    }

    function customAmount(pid) {
        const amt = prompt("Amount to ADD (use - for sub):");
        if(amt && !isNaN(amt)) updateMoney(pid, parseInt(amt));
    }

    // --- TRANSFER / RENT LOGIC ---
    function openTransferModal() {
        const pSelect = document.getElementById('t-payer');
        const rSelect = document.getElementById('t-recipient');
        pSelect.innerHTML = '';
        rSelect.innerHTML = '';

        players.forEach(p => {
            pSelect.add(new Option(`${p.name} (¬£${p.money})`, p.id));
            rSelect.add(new Option(p.name, p.id));
        });
        
        // Add "Bank" as a recipient option
        rSelect.add(new Option(" The Bank", "BANK"));

        document.getElementById('t-amount').value = '';
        document.getElementById('transfer-modal').style.display = 'flex';
    }

    function closeTransferModal() {
        document.getElementById('transfer-modal').style.display = 'none';
    }

    function executeTransfer() {
        const payerId = parseInt(document.getElementById('t-payer').value);
        const recipientVal = document.getElementById('t-recipient').value;
        const amount = parseInt(document.getElementById('t-amount').value);

        if(!amount || amount <= 0) return alert("Enter valid amount");
        if(payerId == recipientVal) return alert("Cannot pay yourself!");

        // Deduct from Payer
        const payer = players.find(p => p.id === payerId);
        payer.money -= amount;

        // Add to Recipient (if not Bank)
        if(recipientVal !== "BANK") {
            const recipient = players.find(p => p.id === parseInt(recipientVal));
            recipient.money += amount;
        }

        closeTransferModal();
        renderPlayers();
    }

    // --- PROPERTY MANAGER ---
    function openPropModal(pid) {
        const p = players.find(x => x.id === pid);
        const container = document.getElementById('prop-list-container');
        container.innerHTML = `<p>Assigning for: <b>${p.name}</b></p>`;

        // Unowned
        const unowned = properties.filter(x => x.owner === null);
        
        // Render
        let html = '';
        unowned.forEach(prop => {
            html += `
                <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee; align-items:center;">
                    <span style="border-left: 5px solid ${prop.c}; padding-left:10px;">${prop.name} (¬£${prop.p})</span>
                    <button class="btn btn-go" style="padding:5px 10px; font-size:0.8rem;" onclick="buyProp(${pid}, ${prop.id})">Buy</button>
                </div>
            `;
        });
        
        // My Properties (to sell)
        const mine = properties.filter(x => x.owner === pid);
        if(mine.length > 0) {
            html += `<h4 style="margin-top:20px; color:#c0392b;">Sell / Return</h4>`;
            mine.forEach(prop => {
                html += `
                    <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee; align-items:center;">
                        <span style="border-left: 5px solid ${prop.c}; padding-left:10px;">${prop.name}</span>
                        <button class="btn btn-jail" style="padding:5px 10px; font-size:0.8rem;" onclick="sellProp(${pid}, ${prop.id})">Return</button>
                    </div>
                `;
            });
        }

        container.innerHTML += html;
        document.getElementById('prop-modal').style.display = 'flex';
    }

    function buyProp(pid, propId) {
        const prop = properties.find(x => x.id === propId);
        if(confirm(`Buy ${prop.name} for ¬£${prop.p}?`)) {
            prop.owner = pid;
            updateMoney(pid, -prop.p);
            document.getElementById('prop-modal').style.display = 'none';
        }
    }

    function sellProp(pid, propId) {
        const prop = properties.find(x => x.id === propId);
        const val = prop.p / 2;
        if(confirm(`Return ${prop.name} to bank for ¬£${val}?`)) {
            prop.owner = null;
            updateMoney(pid, val);
            document.getElementById('prop-modal').style.display = 'none';
        }
    }

</script>
</body>
</html>
