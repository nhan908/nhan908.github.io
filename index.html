<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Monopoly Tracker</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #27ae60;
            --danger: #c0392b;
            --light: #f4f6f7;
            --dark: #2c3e50;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body { margin: 0; padding: 0; background-color: #dcdde1; color: var(--dark); -webkit-font-smoothing: antialiased; }

        .container { max-width: 800px; margin: 0 auto; padding: 15px; }

        header { text-align: center; margin-bottom: 15px; }
        h1 { margin: 0; font-size: 1.5rem; color: var(--primary); }

        /* Setup Section */
        #setup-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        input[type="text"] { padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem; }

        /* Game Section */
        .dice-panel {
            background: white;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .dice-readout { display: flex; align-items: center; gap: 15px; }
        .die {
            width: 45px; height: 45px;
            background: #fff; border: 2px solid #333; border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; font-weight: bold;
        }
        .total-display { font-size: 1.2rem; font-weight: bold; margin-left: 10px;}

        /* Buttons */
        .btn { border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: background 0.1s; }
        .btn:active { transform: translateY(1px); }
        .btn-roll { background: var(--primary); color: white; padding: 10px 25px; font-size: 1.1rem; }
        .btn-start { background: var(--accent); color: white; padding: 10px 30px; margin-top: 10px; }
        
        /* Player Grid */
        .players-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px; }
        
        .player-card {
            background: white; border-radius: 12px; padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-top: 5px solid transparent;
        }

        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .p-name { font-size: 1.2rem; font-weight: 700; }
        .p-money { font-size: 1.4rem; color: var(--accent); font-weight: 800; }

        /* Money Controls Grid */
        .controls-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px; }
        .btn-green { background: #e8f8f5; color: #27ae60; }
        .btn-red { background: #fdedec; color: #c0392b; }
        .btn-blue { background: #ebf5fb; color: #2980b9; grid-column: span 2; }
        .btn-gray { background: #eee; color: #333; }

        /* Property Badge List */
        .prop-container { min-height: 30px; display: flex; flex-wrap: wrap; gap: 5px; }
        .prop-badge {
            font-size: 0.75rem; color: white; padding: 3px 8px; border-radius: 4px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3); display: inline-block;
        }

        /* Modal */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); align-items: center; justify-content: center; z-index: 100;
        }
        .modal {
            background: white; width: 95%; max-width: 450px; border-radius: 10px;
            max-height: 85vh; display: flex; flex-direction: column; overflow: hidden;
        }
        .modal-header { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #f9f9f9; }
        .modal-body { padding: 0; overflow-y: auto; }
        
        .prop-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 15px; border-bottom: 1px solid #f0f0f0;
        }
        .prop-row:hover { background: #fdfdfd; }
        .prop-info { display: flex; align-items: center; gap: 10px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; border: 1px solid #ccc; flex-shrink: 0; }
        
        .buy-btn { background: var(--accent); color: white; font-size: 0.8rem; padding: 6px 12px; border-radius: 4px; border:none; cursor: pointer; }
        .assign-btn { background: #95a5a6; color: white; font-size: 0.8rem; padding: 6px 12px; border-radius: 4px; border:none; cursor: pointer; margin-left: 5px;}
        
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ðŸ‡¬ðŸ‡§ Monopoly Tracker</h1>
    </header>

    <div id="setup-section">
        <h3>Add Players</h3>
        <input type="text" id="new-name" placeholder="Name (e.g., Banker)" onkeypress="handleEnter(event)">
        <button class="btn btn-roll" style="padding: 8px 20px;" onclick="addPlayer()">Add</button>
        <div id="setup-preview" style="margin-top: 15px; font-style: italic; color: #666;"></div>
        <button class="btn btn-start" onclick="startGame()">Start Game</button>
    </div>

    <div id="game-section" class="hidden">
        
        <div class="dice-panel">
            <div class="dice-readout">
                <div id="d1" class="die">1</div>
                <div id="d2" class="die">1</div>
                <div class="total-display">Total: <span id="dt">2</span></div>
            </div>
            <button class="btn btn-roll" onclick="rollDice()">ROLL</button>
        </div>

        <div id="players-root" class="players-grid"></div>
    </div>
</div>

<div id="modal-overlay" class="modal-overlay" onclick="if(event.target === this) closeModal()">
    <div class="modal">
        <div class="modal-header">
            <h3 style="margin:0">Manage Properties</h3>
            <button class="btn" style="padding: 5px 10px; background:#ddd;" onclick="closeModal()">X</button>
        </div>
        <div class="modal-body" id="modal-list">
            </div>
    </div>
</div>

<script>
    // --- UK DATA ---
    // Standard UK Monopoly Board (London)
    const propertiesData = [
        { name: "Old Kent Road", color: "#8B4513", price: 60 },
        { name: "Whitechapel Road", color: "#8B4513", price: 60 },
        { name: "Kings Cross Station", color: "#000000", price: 200 },
        { name: "The Angel, Islington", color: "#87CEEB", price: 100 },
        { name: "Euston Road", color: "#87CEEB", price: 100 },
        { name: "Pentonville Road", color: "#87CEEB", price: 120 },
        { name: "Pall Mall", color: "#C71585", price: 140 },
        { name: "Electric Company", color: "#777777", price: 150 },
        { name: "Whitehall", color: "#C71585", price: 140 },
        { name: "Northumberland Ave", color: "#C71585", price: 160 },
        { name: "Marylebone Station", color: "#000000", price: 200 },
        { name: "Bow Street", color: "#FFA500", price: 180 },
        { name: "Marlborough Street", color: "#FFA500", price: 180 },
        { name: "Vine Street", color: "#FFA500", price: 200 },
        { name: "Strand", color: "#FF0000", price: 220 },
        { name: "Fleet Street", color: "#FF0000", price: 220 },
        { name: "Trafalgar Square", color: "#FF0000", price: 240 },
        { name: "Fenchurch St. Station", color: "#000000", price: 200 },
        { name: "Leicester Square", color: "#FFFF00", price: 260 },
        { name: "Coventry Street", color: "#FFFF00", price: 260 },
        { name: "Water Works", color: "#777777", price: 150 },
        { name: "Piccadilly", color: "#FFFF00", price: 280 },
        { name: "Regent Street", color: "#008000", price: 300 },
        { name: "Oxford Street", color: "#008000", price: 300 },
        { name: "Bond Street", color: "#008000", price: 320 },
        { name: "Liverpool St. Station", color: "#000000", price: 200 },
        { name: "Park Lane", color: "#00008B", price: 350 },
        { name: "Mayfair", color: "#00008B", price: 400 }
    ];

    let players = [];
    let gameProps = propertiesData.map((p, i) => ({ ...p, id: i, owner: null }));
    let activePlayerModal = null;

    // --- SETUP ---
    function handleEnter(e) { if(e.key === 'Enter') addPlayer(); }

    function addPlayer() {
        const input = document.getElementById('new-name');
        if (!input.value.trim()) return;
        
        players.push({ id: Date.now(), name: input.value.trim(), money: 1500 });
        input.value = '';
        
        // Update Preview
        document.getElementById('setup-preview').innerText = 
            players.map(p => p.name).join(', ');
    }

    function startGame() {
        if (players.length === 0) return alert("Add players first!");
        document.getElementById('setup-section').classList.add('hidden');
        document.getElementById('game-section').classList.remove('hidden');
        renderGame();
    }

    // --- LOGIC ---
    function rollDice() {
        // No animation, pure logic per request
        const d1 = Math.floor(Math.random() * 6) + 1;
        const d2 = Math.floor(Math.random() * 6) + 1;
        document.getElementById('d1').innerText = d1;
        document.getElementById('d2').innerText = d2;
        document.getElementById('dt').innerText = d1 + d2;
    }

    function modMoney(pid, amount) {
        const p = players.find(x => x.id === pid);
        if (p) p.money += amount;
        renderGame();
    }

    function customMoney(pid) {
        const val = prompt("Enter amount (positive to add, negative to subtract):");
        if (val && !isNaN(val)) modMoney(pid, parseInt(val));
    }

    // --- PROPERTY MANAGEMENT ---
    function openPropModal(pid) {
        activePlayerModal = pid;
        const p = players.find(x => x.id === pid);
        const modalList = document.getElementById('modal-list');
        modalList.innerHTML = `<div style="padding:15px; background:#f0f0f0;">Viewing: <b>${p.name} (Â£${p.money})</b></div>`;

        // Filter lists
        const unowned = gameProps.filter(x => x.owner === null);
        const mine = gameProps.filter(x => x.owner === pid);

        // 1. My Properties (To Sell/Return)
        if (mine.length > 0) {
            modalList.innerHTML += `<div style="padding:10px 15px; font-weight:bold; color:#555; background:#e8e8e8;">My Properties (Click to Return)</div>`;
            mine.forEach(prop => {
                modalList.innerHTML += `
                    <div class="prop-row">
                        <div class="prop-info">
                            <span class="dot" style="background:${prop.color}"></span>
                            ${prop.name}
                        </div>
                        <button class="btn-red btn" style="font-size:0.8rem; padding:5px 10px;" onclick="sellProp(${prop.id})">Return (+Â£${prop.price/2})</button>
                    </div>
                `;
            });
        }

        // 2. Unowned Properties (To Buy)
        modalList.innerHTML += `<div style="padding:10px 15px; font-weight:bold; color:#555; background:#e8e8e8; margin-top:10px;">Available to Buy</div>`;
        unowned.forEach(prop => {
            modalList.innerHTML += `
                <div class="prop-row">
                    <div class="prop-info">
                        <span class="dot" style="background:${prop.color}"></span>
                        <div>
                            <div>${prop.name}</div>
                            <small style="color:#666">Â£${prop.price}</small>
                        </div>
                    </div>
                    <div>
                        <button class="buy-btn" onclick="buyProp(${prop.id}, ${prop.price})">Buy & Deduct</button>
                        <button class="assign-btn" onclick="assignFree(${prop.id})">Free</button>
                    </div>
                </div>
            `;
        });

        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function buyProp(propId, cost) {
        // Instant deduction logic
        const p = players.find(x => x.id === activePlayerModal);
        if (p.money < cost) {
            if(!confirm(`Player only has Â£${p.money}. Buy for Â£${cost} anyway?`)) return;
        }
        
        gameProps.find(x => x.id === propId).owner = activePlayerModal;
        p.money -= cost; // Auto deduct
        closeModal();
        renderGame();
    }

    function assignFree(propId) {
        gameProps.find(x => x.id === propId).owner = activePlayerModal;
        closeModal();
        renderGame();
    }

    function sellProp(propId) {
        const prop = gameProps.find(x => x.id === propId);
        const val = prop.price / 2;
        if(confirm(`Return ${prop.name} to bank and receive Â£${val}?`)) {
            prop.owner = null;
            players.find(x => x.id === activePlayerModal).money += val;
            closeModal();
            renderGame();
        }
    }

    function closeModal() {
        document.getElementById('modal-overlay').style.display = 'none';
        activePlayerModal = null;
    }

    // --- RENDER ---
    function renderGame() {
        const root = document.getElementById('players-root');
        root.innerHTML = '';

        players.forEach(p => {
            const myProps = gameProps.filter(x => x.owner === p.id).sort((a,b) => a.id - b.id);
            const propBadges = myProps.map(prop => 
                `<span class="prop-badge" style="background:${prop.color}">${prop.name}</span>`
            ).join('');

            root.innerHTML += `
                <div class="player-card" style="border-top-color: ${myProps.length > 0 ? myProps[0].color : 'transparent'}">
                    <div class="card-header">
                        <span class="p-name">${p.name}</span>
                        <span class="p-money">Â£${p.money}</span>
                    </div>

                    <div class="controls-grid">
                        <button class="btn btn-green" onclick="modMoney(${p.id}, 200)">Pass Go (+200)</button>
                        <button class="btn btn-red" onclick="modMoney(${p.id}, -50)">Jail / Dr. (-50)</button>
                        <button class="btn btn-gray" onclick="modMoney(${p.id}, 50)">+50</button>
                        <button class="btn btn-gray" onclick="modMoney(${p.id}, -50)">-50</button>
                        <button class="btn btn-gray" onclick="customMoney(${p.id})">Custom Amount...</button>
                        <button class="btn btn-blue" onclick="openPropModal(${p.id})">Manage Properties ${myProps.length > 0 ? '('+myProps.length+')' : ''}</button>
                    </div>

                    <div class="prop-container">
                        ${propBadges || '<small style="color:#aaa">No properties</small>'}
                    </div>
                </div>
            `;
        });
    }
</script>

</body>
</html>
